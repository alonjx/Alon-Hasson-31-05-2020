(this["webpackJsonpsimple-message"]=this["webpackJsonpsimple-message"]||[]).push([[0],{33:function(e,t,a){e.exports=a(47)},46:function(e,t,a){},47:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),i=a(13),r=a.n(i),c=(a(38),a(5)),o=a(6),l=a(7),u=a(12),h=a(11),m=a(24),d=new(a(26).Dispatcher),g=a(19),v=a.n(g),p=new(function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).dispatchToken=d.register(e.dispatcherCallback.bind(Object(c.a)(e))),e}return Object(l.a)(a,[{key:"emitChange",value:function(e){this.emit(e)}},{key:"getAll",value:function(){return this.messages}},{key:"getAllReceived",value:function(e){var t={};return this.messages&&(Object.filter=function(e,t){return Object.fromEntries(Object.entries(e).filter(t))},t=Object.filter(this.messages,(function(t){var a=Object(m.a)(t,2);a[0];return a[1].receiver===e}))),t}},{key:"getAllSent",value:function(e){var t={};return this.messages&&(Object.filter=function(e,t){return Object.fromEntries(Object.entries(e).filter(t))},t=Object.filter(this.messages,(function(t){var a=Object(m.a)(t,2);a[0];return a[1].sender===e}))),t}},{key:"dispatcherCallback",value:function(e){switch(e.type){case"MESSAGES_FETCHED":this.messages=e.messages;break;case"NOTIFICATION":this.handleNotification(e.variant,e.content)}return this.emitChange(e.type),!0}},{key:"addChangeListener",value:function(e,t){this.on(e,t)}},{key:"removeChangeListener",value:function(e,t){this.removeListener(e,t)}},{key:"handleNotification",value:function(e,t){g.store.addNotification({message:t,type:e,insert:"top",container:"top-right",animationIn:["animated","fadeIn"],animationOut:["animated","fadeOut"],dismiss:{duration:2500}})}}]),a}(a(42).EventEmitter)),E=a(21),b=a.n(E),f=new(function(){function e(){Object(o.a)(this,e)}return Object(l.a)(e,[{key:"sendMessage",value:function(e,t,a,s){b.a.ajax({type:"POST",dataType:"json",url:"/send",data:{sender:e,receiver:t,subject:a,content:s},success:function(e){"done"===e?(d.dispatch({type:"MESSAGE_SENT"}),d.dispatch({type:"NOTIFICATION",variant:"success",content:"Message Sent!"})):d.dispatch({type:"danger",value:"Error: "+e.responseText})},error:function(e,t,a){alert("Error, status = "+t+", error thrown: "+a)}})}},{key:"removeMessage",value:function(e){b.a.ajax({type:"POST",dataType:"json",url:"/delete",data:{message_id:e},success:function(e){"done"===e?(d.dispatch({type:"MESSAGE_DELETED"}),d.dispatch({type:"NOTIFICATION",variant:"success",content:"Message deleted!"})):d.dispatch({type:"NOTIFICATION",variant:"danger",content:"Error: "+e})},error:function(e,t,a){alert("Error, status = "+t+", error thrown: "+a)}})}},{key:"loadData",value:function(e){b.a.ajax({type:"POST",dataType:"json",url:"/messages",data:{user_id:e},success:function(e){d.dispatch({type:"MESSAGES_FETCHED",messages:e})},error:function(e,t,a){alert("Error, status = "+t+", error thrown: "+a)}})}}]),e}()),y=a(22),C=a(49),S=a(50),j=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).handleClose=function(){return e.setState({show:!1})},e.handleShow=function(){return e.setState({show:!0})},e.state={receiver:"",subject:"",content:"",show:!1,error:""},e.handleChange=e.handleChange.bind(Object(c.a)(e)),e.onSubmit=e.onSubmit.bind(Object(c.a)(e)),e.cleanForm=e.cleanForm.bind(Object(c.a)(e)),e}return Object(l.a)(a,[{key:"onSubmit",value:function(e){e.preventDefault(),""===this.state.receiver?this.setState({error:"Receiver ID must not be empty"}):""===this.state.subject?this.setState({error:"Subject must not be empty"}):this.state.content.length<5?this.setState({error:"Message content must contain at least 5 chars"}):f.sendMessage(this.props.sender,this.state.receiver,this.state.subject,this.state.content)}},{key:"cleanForm",value:function(){this.handleClose(),this.setState({receiver:"",subject:"",content:"",error:""})}},{key:"handleChange",value:function(e){this.setState(Object(y.a)({},e.target.id,e.target.value))}},{key:"componentDidMount",value:function(){p.addChangeListener("MESSAGE_SENT",this.cleanForm)}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("div",{className:"fa fa-plus-circle fa-4x",variant:"primary",onClick:this.handleShow}),n.a.createElement(C.a,{show:this.state.show,onHide:this.handleClose},n.a.createElement(C.a.Header,{closeButton:!0},n.a.createElement(C.a.Title,null,"New Message")),n.a.createElement(C.a.Body,null,n.a.createElement("form",null,n.a.createElement("input",{type:"text",onChange:this.handleChange,maxlength:"16",id:"receiver",className:"form-control mb-3",placeholder:"Receiver ID",value:this.state.receiver}),n.a.createElement("input",{type:"text",onChange:this.handleChange,maxlength:"30",id:"subject",className:"form-control mb-3",placeholder:"Subject",value:this.state.subject}),n.a.createElement("textarea",Object(y.a)({className:"form-control mb-3",onChange:this.handleChange,id:"content",value:this.state.content,placeholder:"Message content..."},"id","content"))),n.a.createElement("div",{className:"float-left text-danger"},this.state.error&&"* "+this.state.error)),n.a.createElement(C.a.Footer,null,n.a.createElement(S.a,{variant:"secondary",onClick:this.handleClose},"Close"),n.a.createElement(S.a,{variant:"primary",onClick:this.onSubmit},"Send"))))}}]),a}(n.a.Component),O=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).onClick=s.onClick.bind(Object(c.a)(s)),s.onRemoveConfirm=s.onRemoveConfirm.bind(Object(c.a)(s)),s.state={show:!1},s.handleClose=function(){return s.setState({show:!1})},s.handleShow=function(){return s.setState({show:!0})},s}return Object(l.a)(a,[{key:"onClick",value:function(){this.props.onClick(this.props.id)}},{key:"onRemoveConfirm",value:function(){this.props.onRemove(this.props.id)}},{key:"render",value:function(){return n.a.createElement("li",{className:"list-group-item message-tab",onClick:this.onClick},n.a.createElement(C.a,{show:this.state.show,onHide:this.handleClose,size:"sm"},n.a.createElement(C.a.Header,{closeButton:!0},n.a.createElement(C.a.Title,null,"Are you sure?")),n.a.createElement(C.a.Body,null,n.a.createElement(S.a,{variant:"secondary",onClick:this.handleClose},"Cancel")," ",n.a.createElement(S.a,{variant:"primary",onClick:this.onRemoveConfirm},"Yes"))),n.a.createElement("div",{className:"data p-2"},this.props.data.subject,n.a.createElement("div",{className:"date"},this.props.data.creation_date)),n.a.createElement("div",{className:"icon"},n.a.createElement("i",{className:"fa fa-remove",onClick:this.handleShow})))}}]),a}(n.a.Component),k=(a(45),a(46),function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:"card p-5"},n.a.createElement("header",null,n.a.createElement("h3",null,this.props.data.subject)),n.a.createElement("div",{className:""},n.a.createElement("h6",null,"From: ",this.props.data.sender),n.a.createElement("h6",null,"to: ",this.props.data.receiver)),n.a.createElement("br",null),n.a.createElement("div",null,n.a.createElement("h5",null,this.props.data.content)))}}]),a}(n.a.Component)),M=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).state={user_id:"aaa@gmail.com",selected_message:"",message_type:"received",messages:{},sent_messages:{},received_messages:{}},s.onChangeMessages=s.onChangeMessages.bind(Object(c.a)(s)),s.messageTabClick=s.messageTabClick.bind(Object(c.a)(s)),s.onRemoveMessage=s.onRemoveMessage.bind(Object(c.a)(s)),s.displaySentMessages=s.changeMessageType.bind(Object(c.a)(s),"sent"),s.displayReceivedMessages=s.changeMessageType.bind(Object(c.a)(s),"received"),s.onMessageAction=s.onMessageAction.bind(Object(c.a)(s)),s}return Object(l.a)(a,[{key:"onMessageAction",value:function(){f.loadData(this.state.user_id)}},{key:"onChangeMessages",value:function(){"received"===this.state.message_type?this.setState({messages:p.getAllReceived(this.state.user_id),selected_message:""}):this.setState({messages:p.getAllSent(this.state.user_id),selected_message:""})}},{key:"changeMessageType",value:function(e){"received"===e&&"received"!==this.state.message_type?this.setState({selected_message:"",messages:p.getAllReceived(this.state.user_id),message_type:"received"}):"sent"===e&&"sent"!==this.state.message_type&&this.setState({selected_message:"",messages:p.getAllSent(this.state.user_id),message_type:"sent"})}},{key:"componentWillUnmount",value:function(){p.removeChangeListener("MESSAGES_FETCHED",this.onChangeMessages),p.removeChangeListener("MESSAGE_DELETED",this.onMessageAction),p.removeChangeListener("MESSAGE_SENT",this.onMessageAction)}},{key:"componentDidMount",value:function(){p.addChangeListener("MESSAGES_FETCHED",this.onChangeMessages),p.addChangeListener("MESSAGE_DELETED",this.onMessageAction),p.addChangeListener("MESSAGE_SENT",this.onMessageAction),f.loadData(this.state.user_id)}},{key:"userIdChange",value:function(e){this.setState({user_id:e.target.value}),f.loadData(e.target.value)}},{key:"messageTabClick",value:function(e){this.setState({selected_message:e})}},{key:"onRemoveMessage",value:function(e){f.removeMessage(e)}},{key:"render",value:function(){var e=this,t=Object.keys(this.state.messages).map((function(t){return n.a.createElement(O,{onClick:e.messageTabClick,onRemove:e.onRemoveMessage,key:t,id:t,data:e.state.messages[t]})}));return n.a.createElement("div",{className:"wrapper"},n.a.createElement(v.a,null),n.a.createElement("nav",{id:"sidebar",className:"d-flex flex-column"},n.a.createElement("li",{className:"list-group-item"},"Who are you? ",n.a.createElement("input",{type:"text",className:"form-control",id:"userid",onChange:this.userIdChange.bind(this),value:this.state.user_id})),n.a.createElement("div",{className:"list-group list-group-horizontal d-flex"},n.a.createElement("button",{id:"receivedbtn",onClick:this.displayReceivedMessages,className:"list-group-item flex-fill rounded-0 ".concat("received"===this.state.message_type?"active":"")}," Received",n.a.createElement("span",{className:"badge"},Object.keys(p.getAllReceived(this.state.user_id)).length)),n.a.createElement("button",{href:"#",id:"sentbtn",onClick:this.displaySentMessages,className:"list-group-item flex-fill rounded-0 ".concat("sent"===this.state.message_type?"active":"")}," Sent",n.a.createElement("span",{className:"badge"},Object.keys(p.getAllSent(this.state.user_id)).length))),t),n.a.createElement("div",{className:"content"},this.state.selected_message?n.a.createElement(k,{data:this.state.messages[this.state.selected_message]}):n.a.createElement("div",{className:"banner"},"Simple Message"),n.a.createElement(j,{sender:this.state.user_id})))}}]),a}(n.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[33,1,2]]]);
//# sourceMappingURL=main.272498c3.chunk.js.map